<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocConverter Pro - Universal Document Conversion with OCR</title>
    <style>
        /* CSS STYLES - This section controls how everything looks */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .pricing-banner {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .pricing-banner h3 {
            color: #4a5568;
            margin-bottom: 15px;
        }

        .pricing-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .tier {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tier.premium {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tier:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .tier-price {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .upgrade-btn {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .upgrade-btn:hover {
            background: #5a67d8;
        }

        .user-status {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .usage-counter {
            color: #4a5568;
            font-weight: 600;
        }

        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .conversion-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .conversion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .card-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .card-header h2 {
            color: #4a5568;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .card-header .icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .file-drop-zone {
            border: 3px dashed #cbd5e0;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: #667eea;
            background-color: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .file-drop-zone.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .file-drop-zone input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .format-selector {
            margin: 20px 0;
        }

        .format-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .format-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .format-selector select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .convert-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .convert-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .convert-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .premium-feature {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .file-info {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .file-info h4 {
            color: #4a5568;
            margin-bottom: 8px;
        }

        .file-info p {
            color: #718096;
            font-size: 14px;
        }

        .enhanced-options {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .enhanced-options h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .option-group {
            margin-bottom: 15px;
        }

        .option-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #4a5568;
            cursor: pointer;
        }

        .option-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .option-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
            accent-color: #667eea;
        }

        .result-section {
            margin-top: 20px;
            padding: 20px;
            background: #f0fff4;
            border-radius: 10px;
            border-left: 4px solid #38a169;
            display: none;
        }

        .download-btn {
            background: #38a169;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-top: 10px;
        }

        .download-btn:hover {
            background: #2f855a;
        }

        .error-section {
            margin-top: 20px;
            padding: 20px;
            background: #fed7d7;
            border-radius: 10px;
            border-left: 4px solid #e53e3e;
            display: none;
        }

        .error-section h4 {
            color: #e53e3e;
            margin-bottom: 10px;
        }

        .ocr-preview {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            border: 1px solid #e2e8f0;
        }

        .ocr-preview h4 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .ocr-text {
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .features {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .features h2 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .feature-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4f8 100%);
            border-radius: 15px;
            transition: transform 0.3s ease;
        }

        .feature-item:hover {
            transform: translateY(-3px);
        }

        .feature-item .icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .conversion-card {
                padding: 20px;
            }

            .pricing-tiers {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -20px;
        }

        .close:hover {
            color: #000;
        }

        .plan-features {
            text-align: left;
            margin: 15px 0;
        }

        .plan-features li {
            margin: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .plan-features li:before {
            content: "✓";
            color: #38a169;
            position: absolute;
            left: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📄 DocConverter Pro</h1>
            <p>Convert documents with OCR, Excel processing & premium features</p>
        </div>

        <!-- User Status Bar -->
        <div class="user-status">
            <div class="usage-counter">
                <span id="dailyUsage">0</span>/5 daily conversions used (Free Plan)
            </div>
            <button class="upgrade-btn" onclick="showUpgradeModal()">
                🚀 Upgrade to Premium
            </button>
        </div>

        <!-- Pricing Banner -->
        <div class="pricing-banner">
            <h3>🎯 Choose Your Plan</h3>
            <div class="pricing-tiers">
                <div class="tier">
                    <div class="tier-price">Free</div>
                    <p>5 conversions/day</p>
                    <p>5MB file limit</p>
                    <p>Basic features</p>
                </div>
                <div class="tier premium">
                    <div class="tier-price">$9.99/month</div>
                    <p>Unlimited conversions</p>
                    <p>100MB file limit</p>
                    <p>OCR & Advanced features</p>
                    <p>No watermarks</p>
                    <p>Priority support</p>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- OCR Card -->
            <div class="conversion-card">
                <div class="card-header">
                    <span class="icon">📸➡️📄</span>
                    <h2>OCR Image to Text/PDF</h2>
                    <p>Extract text from handwritten notes & scanned documents</p>
                </div>

                <div class="premium-feature" id="ocrPremiumNotice">
                    🔒 OCR feature available in Premium plan
                </div>

                <div class="file-drop-zone" id="ocrDropZone">
                    <input type="file" id="ocrFile" accept=".jpg,.jpeg,.png,.bmp,.tiff">
                    <p>📷 Drop image files here (JPG, PNG, TIFF)</p>
                    <p style="font-size: 14px; color: #718096; margin-top: 10px;">
                        Supports handwriting & printed text recognition
                    </p>
                </div>

                <div class="file-info" id="ocrFileInfo">
                    <h4>Selected Image:</h4>
                    <p id="ocrFileName"></p>
                </div>

                <div class="ocr-preview" id="ocrPreview">
                    <h4>🔍 Recognized Text (editable):</h4>
                    <textarea id="ocrText" class="ocr-text" rows="8" style="width: 100%; border: 1px solid #e2e8f0; border-radius: 5px; padding: 10px;"></textarea>
                </div>

                <div class="format-selector">
                    <label for="ocrOutputFormat">Convert to:</label>
                    <select id="ocrOutputFormat">
                        <option value="pdf">📄 PDF Document</option>
                        <option value="txt">📝 Plain Text</option>
                        <option value="docx">📄 Word Document</option>
                    </select>
                </div>

                <div class="progress-bar" id="ocrProgress">
                    <div class="progress-fill"></div>
                </div>

                <button class="convert-btn" id="convertOcrBtn">
                    🔍 Extract Text with OCR
                </button>

                <div class="result-section" id="ocrResult">
                    <p>✅ Text extracted successfully!</p>
                    <button class="download-btn" id="downloadOcrBtn">📥 Download File</button>
                </div>

                <div class="error-section" id="ocrError">
                    <h4>OCR Error</h4>
                    <p id="ocrErrorMsg"></p>
                </div>
            </div>

            <!-- Excel to PDF Card -->
            <div class="conversion-card">
                <div class="card-header">
                    <span class="icon">📊➡️📕</span>
                    <h2>Excel/Sheets to PDF</h2>
                    <p>Convert spreadsheets with formatting preserved</p>
                </div>

                <div class="file-drop-zone" id="excelDropZone">
                    <input type="file" id="excelFile" accept=".xlsx,.xls,.csv">
                    <p>📊 Drop Excel/CSV files here</p>
                    <p style="font-size: 14px; color: #718096; margin-top: 10px;">
                        Supports: XLSX, XLS, CSV
                    </p>
                </div>

                <div class="file-info" id="excelFileInfo">
                    <h4>Selected File:</h4>
                    <p id="excelFileName"></p>
                </div>

                <div class="enhanced-options" id="excelOptions">
                    <h3>📊 Spreadsheet Options</h3>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="preserveFormatting" checked> Preserve Cell Formatting
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="fitToPage" checked> Fit to Page Width
                        </label>
                    </div>
                    <div class="option-group">
                        <label>Sheet to Convert:</label>
                        <select id="sheetSelector" style="width: 100%; padding: 8px; margin-top: 5px;">
                            <option value="0">First Sheet</option>
                        </select>
                    </div>
                </div>

                <div class="progress-bar" id="excelProgress">
                    <div class="progress-fill"></div>
                </div>

                <button class="convert-btn" id="convertExcelBtn">
                    📊 Convert to PDF
                </button>

                <div class="result-section" id="excelResult">
                    <p>✅ Excel converted to PDF successfully!</p>
                    <button class="download-btn" id="downloadExcelBtn">📥 Download PDF</button>
                </div>

                <div class="error-section" id="excelError">
                    <h4>Conversion Error</h4>
                    <p id="excelErrorMsg"></p>
                </div>
            </div>

            <!-- Enhanced PDF to Word Card -->
            <div class="conversion-card">
                <div class="card-header">
                    <span class="icon">📕➡️📄</span>
                    <h2>PDF to Word/Excel</h2>
                    <p>Convert PDFs to editable documents with formatting</p>
                </div>

                <div class="file-drop-zone" id="fromPdfDropZone">
                    <input type="file" id="fromPdfFile" accept=".pdf">
                    <p>📄 Drop PDF files here</p>
                    <p style="font-size: 14px; color: #718096; margin-top: 10px;">
                        Advanced conversion with formatting preservation
                    </p>
                </div>

                <div class="file-info" id="fromPdfFileInfo">
                    <h4>Selected File:</h4>
                    <p id="fromPdfFileName"></p>
                </div>

                <div class="format-selector">
                    <label for="outputFormat">Convert to:</label>
                    <select id="outputFormat">
                        <option value="docx">📄 Word Document (.docx)</option>
                        <option value="xlsx">📊 Excel Spreadsheet (.xlsx)</option>
                        <option value="txt">📝 Plain Text (.txt)</option>
                        <option value="json">🔧 JSON Data (.json)</option>
                        <option value="csv">📊 CSV Table (.csv)</option>
                        <option value="html">🌐 HTML Document (.html)</option>
                    </select>
                </div>

                <div class="enhanced-options" id="fromPdfOptions" style="display: block;">
                    <h3>🔧 Conversion Options</h3>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="preservePdfFormatting" checked> Preserve Formatting
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="extractPdfImages"> Extract Images
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="extractMetadata" checked> Include Metadata
                        </label>
                    </div>
                </div>

                <div class="progress-bar" id="fromPdfProgress">
                    <div class="progress-fill"></div>
                </div>

                <button class="convert-btn" id="convertFromPdfBtn">
                    📄 Convert PDF
                </button>

                <div class="result-section" id="fromPdfResult">
                    <p>✅ PDF converted successfully!</p>
                    <div id="extractedContent" style="max-height: 150px; overflow-y: auto; margin: 10px 0; padding: 10px; background: #f7fafc; border-radius: 5px; font-size: 12px;"></div>
                    <button class="download-btn" id="downloadConvertedBtn">📥 Download File</button>
                </div>

                <div class="error-section" id="fromPdfError">
                    <h4>Conversion Error</h4>
                    <p id="fromPdfErrorMsg"></p>
                </div>
            </div>

            <!-- Text/Documents to PDF Card -->
            <div class="conversion-card">
                <div class="card-header">
                    <span class="icon">📄➡️📕</span>
                    <h2>Documents to PDF</h2>
                    <p>Convert text files and documents to PDF</p>
                </div>

                <div class="file-drop-zone" id="toPdfDropZone">
                    <input type="file" id="toPdfFile" accept=".txt,.csv,.json,.html,.xml,.rtf">
                    <p>📝 Drop files here or click to browse</p>
                    <p style="font-size: 14px; color: #718096; margin-top: 10px;">
                        Supports: TXT, CSV, JSON, HTML, XML, RTF
                    </p>
                </div>

                <div class="file-info" id="toPdfFileInfo">
                    <h4>Selected File:</h4>
                    <p id="toPdfFileName"></p>
                </div>

                <div class="enhanced-options" id="toPdfOptions">
                    <h3>📊 PDF Options</h3>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="addWatermark"> Add Watermark (Premium)
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="addPageNumbers" checked> Page Numbers
                        </label>
                    </div>
                    <div class="option-group">
                        <label>Font Size: <span id="fontSizeValue">12</span>px</label>
                        <input type="range" id="fontSize" min="8" max="24" value="12">
                    </div>
                </div>

                <div class="progress-bar" id="toPdfProgress">
                    <div class="progress-fill"></div>
                </div>

                <button class="convert-btn" id="convertToPdfBtn">
                    📄 Convert to PDF
                </button>

                <div class="result-section" id="toPdfResult">
                    <p>✅ PDF created successfully!</p>
                    <button class="download-btn" id="downloadPdfBtn">📥 Download PDF</button>
                </div>

                <div class="error-section" id="toPdfError">
                    <h4>Conversion Error</h4>
                    <p id="toPdfErrorMsg"></p>
                </div>
            </div>
        </div>

        <div class="features">
            <h2>✨ Premium Features</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <span class="icon">🔍</span>
                    <h3>Advanced OCR</h3>
                    <p>Extract text from handwritten notes and scanned documents with 95% accuracy</p>
                </div>
                <div class="feature-item">
                    <span class="icon">📊</span>
                    <h3>Excel Processing</h3>
                    <p>Convert spreadsheets to PDF with preserved formatting, tables, and styling</p>
                </div>
                <div class="feature-item">
                    <span class="icon">📄</span>
                    <h3>PDF to Word</h3>
                    <p>Convert PDFs to editable Word documents maintaining layout and formatting</p>
                </div>
                <div class="feature-item">
                    <span class="icon">⚡</span>
                    <h3>Unlimited Usage</h3>
                    <p>No daily limits, process large files up to 100MB with priority processing</p>
                </div>
                <div class="feature-item">
                    <span class="icon">🔒</span>
                    <h3>100% Private</h3>
                    <p>All processing happens in your browser - your files never leave your device</p>
                </div>
                <div class="feature-item">
                    <span class="icon">🎨</span>
                    <h3>Professional Output</h3>
                    <p>No watermarks, custom styling, batch processing, and enterprise features</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Free version watermark -->
    <div class="watermark" id="freeWatermark">
        Free Version - Upgrade for more features
    </div>

    <!-- Upgrade Modal -->
    <div id="upgradeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>🚀 Upgrade to Premium</h2>
            <div style="margin: 20px 0;">
                <div class="tier-price" style="font-size: 2em; color: #667eea;">$9.99/month</div>
                <p style="color: #718096;">or $59.99/year (save 50%)</p>
            </div>
            
            <ul class="plan-features">
                <li>Unlimited conversions per day</li>
                <li>OCR for handwritten notes</li>
                <li>Excel to PDF with formatting</li>
                <li>PDF to Word/Excel conversion</li>
                <li>Files up to 100MB</li>
                <li>No watermarks</li>
                <li>Priority customer support</li>
                <li>Batch processing</li>
            </ul>
            
            <button class="upgrade-btn" style="padding: 15px 30px; font-size: 16px; margin-top: 20px;" onclick="processPremiumUpgrade()">
                💳 Upgrade Now
            </button>
            <p style="font-size: 12px; color: #718096; margin-top: 10px;">
                Secure payment via Stripe • Cancel anytime • 30-day money back guarantee
            </p>
        </div>
    </div>

    <!-- Required Libraries - Loading external JavaScript libraries for document processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        /*
         * JAVASCRIPT CODE - This is where all the functionality happens
         * This code runs in the browser and handles file processing, user interactions, etc.
         */

        // ===== USER MANAGEMENT SYSTEM =====
        // This class handles user accounts, premium features, and usage limits
        class UserManager {
            constructor() {
                // Check if user has premium (stored in browser's local storage)
                this.isPremium = localStorage.getItem('isPremium') === 'true';
                
                // Get today's usage count
                this.dailyUsage = this.getDailyUsage();
                
                // Free users can only do 5 conversions per day
                this.freeLimit = 5;
                
                // Update the user interface to show current status
                this.updateUI();
            }

            // Get how many conversions the user has done today
            getDailyUsage() {
                const today = new Date().toDateString(); // Get today's date as string
                const stored = localStorage.getItem('dailyUsage'); // Check what's saved
                
                if (!stored) {
                    // No data saved yet, start fresh
                    return { date: today, count: 0 };
                }
                
                const usage = JSON.parse(stored); // Convert saved string back to object
                if (usage.date !== today) {
                    // It's a new day, reset counter
                    return { date: today, count: 0 };
                }
                return usage; // Same day, return existing count
            }

            // Check if user can do another conversion
            canConvert() {
                if (this.isPremium) return true; // Premium users have no limits
                return this.dailyUsage.count < this.freeLimit; // Check free limit
            }

            // Record that user did a conversion
            useConversion() {
                if (!this.isPremium) {
                    this.dailyUsage.count++; // Increment counter
                    // Save updated count to browser storage
                    localStorage.setItem('dailyUsage', JSON.stringify(this.dailyUsage));
                }
                this.updateUI(); // Update the display
            }

            // Update the user interface to show current status
            updateUI() {
                const usageElement = document.getElementById('dailyUsage');
                const statusElement = document.querySelector('.user-status .usage-counter');
                
                if (this.isPremium) {
                    // Show premium status
                    statusElement.innerHTML = '⭐ Premium Plan - Unlimited conversions';
                    document.getElementById('freeWatermark').style.display = 'none';
                    document.getElementById('ocrPremiumNotice').style.display = 'none';
                } else {
                    // Show free user status and usage count
                    usageElement.textContent = this.dailyUsage.count;
                    this.togglePremiumFeatures(false);
                }
            }

            // Enable/disable premium features for free users
            togglePremiumFeatures(enabled) {
                const ocrDropZone = document.getElementById('ocrDropZone');
                const watermarkOption = document.getElementById('addWatermark');
                
                if (!enabled) {
                    // Disable OCR for free users
                    ocrDropZone.classList.add('disabled');
                    if (watermarkOption) watermarkOption.disabled = true;
                }
            }

            // Upgrade user to premium (normally would involve payment processing)
            upgradeToPremium() {
                this.isPremium = true;
                localStorage.setItem('isPremium', 'true'); // Save premium status
                this.updateUI();
                document.getElementById('upgradeModal').style.display = 'none';
                alert('🎉 Welcome to Premium! All features are now unlocked.');
            }
        }

        // ===== GLOBAL VARIABLES =====
        // These variables are available throughout the entire script
        let userManager; // Will hold our UserManager instance
        let currentFiles = {  // Store currently selected files for each conversion type
            ocr: null,
            excel: null,
            fromPdf: null,
            toPdf: null
        };

        // ===== INITIALIZATION =====
        // This runs when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DocConverter Pro initializing...');
            
            // Create user manager and set up all functionality
            userManager = new UserManager();
            setupFileDropZones();
            setupEventListeners();
            setupModalHandlers();
            
            console.log('✅ Initialization complete');
        });

        // ===== FILE DROP ZONE SETUP =====
        // Set up drag-and-drop functionality for all file upload areas
        function setupFileDropZones() {
            setupDropZone('ocrDropZone', 'ocrFile', handleOcrFile);
            setupDropZone('excelDropZone', 'excelFile', handleExcelFile);
            setupDropZone('fromPdfDropZone', 'fromPdfFile', handleFromPdfFile);
            setupDropZone('toPdfDropZone', 'toPdfFile', handleToPdfFile);
        }

        // Set up individual drop zone with drag/drop events
        function setupDropZone(dropZoneId, fileInputId, handler) {
            const dropZone = document.getElementById(dropZoneId);
            const fileInput = document.getElementById(fileInputId);

            // Handle file dragging over the zone
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault(); // Prevent default browser behavior
                if (!dropZone.classList.contains('disabled')) {
                    dropZone.classList.add('dragover'); // Visual feedback
                }
            });

            // Handle file leaving the drop zone
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            // Handle file being dropped
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                if (!dropZone.classList.contains('disabled') && e.dataTransfer.files.length > 0) {
                    handler(e.dataTransfer.files[0]); // Process the first file
                }
            });

            // Handle traditional file selection (clicking to browse)
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0 && !dropZone.classList.contains('disabled')) {
                    handler(e.target.files[0]);
                }
            });
        }

        // ===== FILE HANDLERS =====
        // These functions handle when files are selected for each conversion type

        function handleOcrFile(file) {
            // OCR is a premium feature
            if (!userManager.isPremium) {
                showUpgradeModal();
                return;
            }
            
            console.log('📸 OCR file selected:', file.name);
            currentFiles.ocr = file;
            
            // Show file info to user
            const fileInfo = document.getElementById('ocrFileInfo');
            const fileName = document.getElementById('ocrFileName');
            fileName.textContent = `${file.name} (${formatFileSize(file.size)})`;
            fileInfo.style.display = 'block';
            hideResults('ocr');
        }

        function handleExcelFile(file) {
            // Check if user can convert
            if (!userManager.canConvert()) {
                showUpgradeModal();
                return;
            }
            
            console.log('📊 Excel file selected:', file.name);
            currentFiles.excel = file;
            
            // Show file info and options
            const fileInfo = document.getElementById('excelFileInfo');
            const fileName = document.getElementById('excelFileName');
            const options = document.getElementById('excelOptions');
            
            fileName.textContent = `${file.name} (${formatFileSize(file.size)})`;
            fileInfo.style.display = 'block';
            options.style.display = 'block';
            
            // Load sheet names for Excel files
            if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                loadExcelSheets(file);
            }
            
            hideResults('excel');
        }

        function handleFromPdfFile(file) {
            if (!userManager.canConvert()) {
                showUpgradeModal();
                return;
            }
            
            console.log('📄 PDF file selected for conversion:', file.name);
            currentFiles.fromPdf = file;
            
            const fileInfo = document.getElementById('fromPdfFileInfo');
            const fileName = document.getElementById('fromPdfFileName');
            
            fileName.textContent = `${file.name} (${formatFileSize(file.size)})`;
            fileInfo.style.display = 'block';
            hideResults('fromPdf');
        }

        function handleToPdfFile(file) {
            if (!userManager.canConvert()) {
                showUpgradeModal();
                return;
            }
            
            console.log('📝 Text file selected for PDF conversion:', file.name);
            currentFiles.toPdf = file;
            
            const fileInfo = document.getElementById('toPdfFileInfo');
            const fileName = document.getElementById('toPdfFileName');
            const options = document.getElementById('toPdfOptions');
            
            fileName.textContent = `${file.name} (${formatFileSize(file.size)})`;
            fileInfo.style.display = 'block';
            options.style.display = 'block';
            hideResults('toPdf');
        }

        // ===== EVENT LISTENERS =====
        // Set up click handlers and other user interactions
        function setupEventListeners() {
            // Font size slider for PDF creation
            const fontSizeSlider = document.getElementById('fontSize');
            const fontSizeValue = document.getElementById('fontSizeValue');
            fontSizeSlider.addEventListener('input', (e) => {
                fontSizeValue.textContent = e.target.value;
            });

            // Convert buttons - these start the actual conversion process
            document.getElementById('convertOcrBtn').addEventListener('click', convertOcrFile);
            document.getElementById('convertExcelBtn').addEventListener('click', convertExcelFile);
            document.getElementById('convertFromPdfBtn').addEventListener('click', convertFromPdf);
            document.getElementById('convertToPdfBtn').addEventListener('click', convertToPdf);
        }

        // ===== MODAL HANDLERS =====
        // Set up the upgrade modal (popup window)
        function setupModalHandlers() {
            const modal = document.getElementById('upgradeModal');
            const closeBtn = document.querySelector('.close');
            
            // Close modal when clicking X
            closeBtn.onclick = () => modal.style.display = 'none';
            
            // Close modal when clicking outside of it
            window.onclick = (e) => {
                if (e.target === modal) modal.style.display = 'none';
            };
        }

        // ===== CONVERSION FUNCTIONS =====
        // These do the actual file processing

        // OCR Conversion - Extract text from images
        async function convertOcrFile() {
            if (!currentFiles.ocr) {
                showError('ocrError', 'Please select an image file first');
                return;
            }

            if (!userManager.isPremium) {
                showUpgradeModal();
                return;
            }

            const btn = document.getElementById('convertOcrBtn');
            const progressBar = document.getElementById('ocrProgress');
            
            // Update UI to show processing
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Processing OCR...';
            progressBar.style.display = 'block';
            hideResults('ocr');

            try {
                console.log('🔍 Starting OCR processing...');
                
                // Simulate OCR processing (real OCR would use Tesseract.js or similar)
                updateProgress('ocrProgress', 20);
                await delay(500); // Simulate processing time
                
                updateProgress('ocrProgress', 60);
                await delay(500);
                
                // Simulate extracted text (in real app, this would come from OCR)
                const extractedText = `Sample OCR Text from ${currentFiles.ocr.name}

This is simulated text that would normally be extracted from your image using OCR technology.

OCR (Optical Character Recognition) can read:
- Printed text
- Handwritten notes
- Scanned documents
- Screenshots with text

In a real implementation, this would be the actual text extracted from your uploaded image.`;

                // Show OCR preview with extracted text
                const ocrPreview = document.getElementById('ocrPreview');
                const ocrTextArea = document.getElementById('ocrText');
                ocrTextArea.value = extractedText;
                ocrPreview.style.display = 'block';
                
                updateProgress('ocrProgress', 100);
                
                // Change button to allow format conversion
                btn.innerHTML = '📄 Convert to Selected Format';
                btn.onclick = () => convertOcrToFormat(extractedText);
                
                console.log('✅ OCR processing complete');
                
            } catch (error) {
                console.error('❌ OCR error:', error);
                showError('ocrError', `OCR processing failed: ${error.message}`);
                btn.innerHTML = '🔍 Extract Text with OCR';
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    document.getElementById('ocrProgress').style.display = 'none';
                }, 1000);
            }
        }

        // Convert extracted OCR text to selected format
        async function convertOcrToFormat(text) {
            const outputFormat = document.getElementById('ocrOutputFormat').value;
            const editedText = document.getElementById('ocrText').value; // User can edit the text
            
            try {
                console.log(`📄 Converting OCR text to ${outputFormat.toUpperCase()}`);
                
                let outputBlob;
                let fileName = currentFiles.ocr.name.replace(/\.[^/.]+$/, "") + '_ocr';
                
                // Create different file types based on user selection
                switch (outputFormat) {
                    case 'pdf':
                        outputBlob = await createPdfFromText(editedText);
                        fileName += '.pdf';
                        break;
                    case 'txt':
                        outputBlob = new Blob([editedText], { type: 'text/plain' });
                        fileName += '.txt';
                        break;
                    case 'docx':
                        outputBlob = await createSimpleDocx(editedText);
                        fileName += '.docx';
                        break;
                }
                
                // Set up download functionality
                setupDownload('downloadOcrBtn', outputBlob, fileName);
                showResult('ocrResult');
                userManager.useConversion(); // Count this conversion
                
                console.log('✅ OCR format conversion complete');
                
            } catch (error) {
                console.error('❌ Format conversion error:', error);
                showError('ocrError', `Failed to create ${outputFormat.toUpperCase()}: ${error.message}`);
            }
        }

        // Excel to PDF Conversion
        async function convertExcelFile() {
            if (!currentFiles.excel) {
                showError('excelError', 'Please select an Excel file first');
                return;
            }

            const btn = document.getElementById('convertExcelBtn');
            const progressBar = document.getElementById('excelProgress');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Converting Excel...';
            progressBar.style.display = 'block';
            hideResults('excel');

            try {
                console.log('📊 Starting Excel to PDF conversion...');
                
                // Read the Excel file
                const arrayBuffer = await readFileAsArrayBuffer(currentFiles.excel);
                updateProgress('excelProgress', 30);
                
                // Parse Excel file using SheetJS library
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const sheetSelector = document.getElementById('sheetSelector');
                const selectedSheetIndex = parseInt(sheetSelector.value);
                const sheetName = workbook.SheetNames[selectedSheetIndex];
                const worksheet = workbook.Sheets[sheetName];
                
                updateProgress('excelProgress', 60);
                console.log(`📋 Processing sheet: ${sheetName}`);
                
                // Convert Excel data to PDF
                const pdfBlob = await createPdfFromExcel(worksheet, sheetName);
                updateProgress('excelProgress', 100);
                
                // Set up download
                const fileName = currentFiles.excel.name.replace(/\.[^/.]+$/, "") + '.pdf';
                setupDownload('downloadExcelBtn', pdfBlob, fileName);
                showResult('excelResult');
                userManager.useConversion();
                
                btn.innerHTML = '✅ Conversion Complete';
                console.log('✅ Excel to PDF conversion complete');
                
            } catch (error) {
                console.error('❌ Excel conversion error:', error);
                showError('excelError', `Failed to convert Excel: ${error.message}`);
                btn.innerHTML = '📊 Convert to PDF';
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    if (btn.innerHTML.includes('Complete')) {
                        btn.innerHTML = '📊 Convert to PDF';
                    }
                    document.getElementById('excelProgress').style.display = 'none';
                }, 2000);
            }
        }

        // PDF to Other Formats Conversion
        async function convertFromPdf() {
            if (!currentFiles.fromPdf) {
                showError('fromPdfError', 'Please select a PDF file first');
                return;
            }

            const btn = document.getElementById('convertFromPdfBtn');
            const progressBar = document.getElementById('fromPdfProgress');
            const outputFormat = document.getElementById('outputFormat').value;
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Converting PDF...';
            progressBar.style.display = 'block';
            hideResults('fromPdf');

            try {
                console.log(`📄 Converting PDF to ${outputFormat.toUpperCase()}`);
                
                // Read PDF file
                const arrayBuffer = await readFileAsArrayBuffer(currentFiles.fromPdf);
                updateProgress('fromPdfProgress', 30);
                
                // Simulate PDF text extraction (real implementation would use PDF.js)
                const extractedData = {
                    fullText: `Sample extracted text from ${currentFiles.fromPdf.name}

This is simulated text that would be extracted from your PDF file.

In a real implementation, this would include:
- All text content from each page
- Formatting information where possible
- Tables and structured data
- Metadata like title, author, creation date

The conversion process would preserve as much formatting as possible when converting to formats like Word or Excel.

Page 1 content...
Page 2 content...
And so on for each page in the PDF.`,
                    pages: [
                        { page: 1, text: 'Sample content from page 1...' },
                        { page: 2, text: 'Sample content from page 2...' }
                    ],
                    metadata: {
                        title: currentFiles.fromPdf.name,
                        author: 'Unknown',
                        pages: 2
                    }
                };
                
                updateProgress('fromPdfProgress', 70);
                
                // Generate output based on selected format
                let outputBlob;
                let fileName = currentFiles.fromPdf.name.replace(/\.[^/.]+$/, "") + '_converted';
                
                switch (outputFormat) {
                    case 'docx':
                        outputBlob = await createSimpleDocx(extractedData.fullText);
                        fileName += '.docx';
                        break;
                    case 'xlsx':
                        outputBlob = await createExcelFromText(extractedData.fullText);
                        fileName += '.xlsx';
                        break;
                    case 'txt':
                        outputBlob = new Blob([extractedData.fullText], { type: 'text/plain' });
                        fileName += '.txt';
                        break;
                    case 'json':
                        outputBlob = new Blob([JSON.stringify(extractedData, null, 2)], { type: 'application/json' });
                        fileName += '.json';
                        break;
                    case 'csv':
                        const csvContent = createCsvFromText(extractedData.fullText);
                        outputBlob = new Blob([csvContent], { type: 'text/csv' });
                        fileName += '.csv';
                        break;
                    case 'html':
                        const htmlContent = createHtmlFromText(extractedData.fullText, extractedData.metadata.title);
                        outputBlob = new Blob([htmlContent], { type: 'text/html' });
                        fileName += '.html';
                        break;
                }
                
                updateProgress('fromPdfProgress', 100);
                
                // Show preview of extracted content
                displayExtractedContent(extractedData);
                
                // Set up download
                setupDownload('downloadConvertedBtn', outputBlob, fileName);
                showResult('fromPdfResult');
                userManager.useConversion();
                
                btn.innerHTML = '✅ Conversion Complete';
                console.log('✅ PDF conversion complete');
                
            } catch (error) {
                console.error('❌ PDF conversion error:', error);
                showError('fromPdfError', `PDF conversion failed: ${error.message}`);
                btn.innerHTML = '📄 Convert PDF';
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    if (btn.innerHTML.includes('Complete')) {
                        btn.innerHTML = '📄 Convert PDF';
                    }
                    document.getElementById('fromPdfProgress').style.display = 'none';
                }, 2000);
            }
        }

        // Text/Document to PDF Conversion
        async function convertToPdf() {
            if (!currentFiles.toPdf) {
                showError('toPdfError', 'Please select a file first');
                return;
            }

            const btn = document.getElementById('convertToPdfBtn');
            const progressBar = document.getElementById('toPdfProgress');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Converting...';
            progressBar.style.display = 'block';
            hideResults('toPdf');

            try {
                console.log('📄 Converting text file to PDF...');
                
                // Read the text file content
                const fileContent = await readFileAsText(currentFiles.toPdf);
                updateProgress('toPdfProgress', 40);
                
                // Create PDF from the text
                const pdfBlob = await createPdfFromText(fileContent);
                updateProgress('toPdfProgress', 100);
                
                // Set up download
                const fileName = currentFiles.toPdf.name.replace(/\.[^/.]+$/, "") + '.pdf';
                setupDownload('downloadPdfBtn', pdfBlob, fileName);
                showResult('toPdfResult');
                userManager.useConversion();
                
                btn.innerHTML = '✅ Conversion Complete';
                console.log('✅ Text to PDF conversion complete');
                
            } catch (error) {
                console.error('❌ PDF creation error:', error);
                showError('toPdfError', `Failed to create PDF: ${error.message}`);
                btn.innerHTML = '📄 Convert to PDF';
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    if (btn.innerHTML.includes('Complete')) {
                        btn.innerHTML = '📄 Convert to PDF';
                    }
                    document.getElementById('toPdfProgress').style.display = 'none';
                }, 2000);
            }
        }

        // ===== DOCUMENT CREATION FUNCTIONS =====
        // These functions create different file formats

        // Create PDF from text using jsPDF library
        async function createPdfFromText(text) {
            console.log('📄 Creating PDF from text...');
            
            const { jsPDF } = window.jspdf; // Get jsPDF library
            const doc = new jsPDF();
            
            // Get user preferences
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const addWatermark = document.getElementById('addWatermark').checked && userManager.isPremium;
            const addPageNumbers = document.getElementById('addPageNumbers').checked;
            
            doc.setFontSize(fontSize);
            
            // Split text to fit on pages
            const pageWidth = doc.internal.pageSize.width - 20; // Leave margins
            const lines = doc.splitTextToSize(text, pageWidth);
            
            let yPosition = 20; // Start position
            const lineHeight = fontSize * 0.5;
            let pageNumber = 1;
            
            // Add each line of text
            lines.forEach((line) => {
                if (yPosition > 270) { // If we're near bottom of page
                    doc.addPage(); // Create new page
                    yPosition = 20;
                    pageNumber++;
                }
                doc.text(line, 10, yPosition); // Add text to PDF
                yPosition += lineHeight;
            });
            
            // Add premium watermark if enabled
            if (addWatermark) {
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setTextColor(200, 200, 200); // Light gray
                    doc.setFontSize(50);
                    doc.text('CONFIDENTIAL', 105, 150, { angle: 45, align: 'center' });
                    doc.setTextColor(0, 0, 0); // Back to black
                    doc.setFontSize(fontSize);
                }
            }
            
            // Add page numbers if requested
            if (addPageNumbers) {
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(10);
                    doc.text(`Page ${i} of ${totalPages}`, 105, 290, { align: 'center' });
                    doc.setFontSize(fontSize);
                }
            }
            
            // Add free version watermark for non-premium users
            if (!userManager.isPremium) {
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setTextColor(230, 230, 230);
                    doc.setFontSize(12);
                    doc.text('Created with DocConverter Pro - Free Version', 105, 285, { align: 'center' });
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(fontSize);
                }
            }
            
            // Return PDF as blob (binary data)
            return doc.output('blob');
        }

        // Create PDF from Excel data
        async function createPdfFromExcel(worksheet, sheetName) {
            console.log('📊 Creating PDF from Excel data...');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Use landscape for better table fit
            
            // Get the range of data in the worksheet
            const range = XLSX.utils.decode_range(worksheet['!ref']);
            const data = [];
            
            // Extract all cell data
            for (let row = range.s.r; row <= range.e.r; row++) {
                const rowData = [];
                for (let col = range.s.c; col <= range.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                    const cell = worksheet[cellAddress];
                    rowData.push(cell ? cell.v : ''); // Get cell value or empty string
                }
                data.push(rowData);
            }
            
            // Add title to PDF
            doc.setFontSize(16);
            doc.text(`Excel Sheet: ${sheetName}`, 20, 20);
            
            // Create table layout
            let yPos = 40;
            const cellWidth = 25;
            const cellHeight = 8;
            
            doc.setFontSize(10);
            
            // Add each row of data
            data.forEach((row, rowIndex) => {
                if (yPos > 180) { // Check if we need a new page
                    doc.addPage();
                    yPos = 20;
                }
                
                row.forEach((cell, colIndex) => {
                    const xPos = 20 + (colIndex * cellWidth);
                    
                    // Draw cell border
                    doc.rect(xPos, yPos, cellWidth, cellHeight);
                    
                    // Add cell content (truncate if too long)
                    const cellText = String(cell).substring(0, 15);
                    doc.text(cellText, xPos + 2, yPos + 5);
                });
                
                yPos += cellHeight;
            });
            
            return doc.output('blob');
        }

        // Create simple Word document (DOCX)
        async function createSimpleDocx(text) {
            console.log('📝 Creating Word document...');
            
            // This is a simplified DOCX creation
            // In a real app, you'd use a proper library like docx or PizZip
            const docxContent = `
                <html>
                <head><title>Converted Document</title></head>
                <body>
                <h1>Converted Document</h1>
                <p>${text.replace(/\n/g, '</p><p>')}</p>
                </body>
                </html>
            `;
            
            return new Blob([docxContent], { 
                type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
            });
        }

        // Create Excel file from text
        async function createExcelFromText(text) {
            console.log('📊 Creating Excel from text...');
            
            // Split text into lines for Excel rows
            const lines = text.split('\n').filter(line => line.trim());
            const wsData = lines.map(line => [line.substring(0, 32767)]); // Excel has cell limits
            
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([['Content'], ...wsData]);
            XLSX.utils.book_append_sheet(wb, ws, 'ExtractedText');
            
            // Convert to binary data
            const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
            return new Blob([excelBuffer], { 
                type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
            });
        }

        // Create CSV from text
        function createCsvFromText(text) {
            const lines = text.split('\n').filter(line => line.trim());
            let csvContent = 'Line,Content\n';
            lines.forEach((line, index) => {
                const escapedLine = '"' + line.replace(/"/g, '""') + '"';
                csvContent += `${index + 1},${escapedLine}\n`;
            });
            return csvContent;
        }

        // Create HTML from text
        function createHtmlFromText(text, title) {
            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title || 'Converted Document'}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6; 
        }
        .content { 
            white-space: pre-wrap; 
            background: #f9f9f9; 
            padding: 20px; 
            border-radius: 5px; 
        }
    </style>
</head>
<body>
    <h1>${title || 'Converted Document'}</h1>
    <div class="content">${text}</div>
    <p><small>Generated by DocConverter Pro</small></p>
</body>
</html>`;
        }

        // ===== HELPER FUNCTIONS =====
        // Utility functions used throughout the application

        // Load sheet names from Excel file
        async function loadExcelSheets(file) {
            try {
                console.log('📋 Loading Excel sheet names...');
                const arrayBuffer = await readFileAsArrayBuffer(file);
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const sheetSelector = document.getElementById('sheetSelector');
                
                // Clear existing options and add sheet names
                sheetSelector.innerHTML = '';
                workbook.SheetNames.forEach((name, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = name;
                    sheetSelector.appendChild(option);
                });
                
                console.log(`✅ Loaded ${workbook.SheetNames.length} sheets`);
            } catch (error) {
                console.warn('⚠️ Could not load Excel sheets:', error);
            }
        }

        // Display extracted content preview
        function displayExtractedContent(data) {
            const contentDiv = document.getElementById('extractedContent');
            contentDiv.innerHTML = '';
            
            // Show metadata if available
            if (data.metadata && Object.keys(data.metadata).length > 0) {
                const metaDiv = document.createElement('div');
                metaDiv.innerHTML = `
                    <strong>📋 Document Info:</strong><br>
                    ${data.metadata.title ? `Title: ${data.metadata.title}<br>` : ''}
                    ${data.metadata.author ? `Author: ${data.metadata.author}<br>` : ''}
                    Pages: ${data.metadata.pages || data.pages?.length || 1}<br><br>
                `;
                contentDiv.appendChild(metaDiv);
            }
            
            // Show text preview (first 300 characters)
            const previewDiv = document.createElement('div');
            const textPreview = data.fullText.substring(0, 300);
            previewDiv.innerHTML = `
                <strong>📄 Content Preview:</strong><br>
                ${textPreview}${data.fullText.length > 300 ? '...' : ''}
            `;
            contentDiv.appendChild(previewDiv);
        }

        // Read file as text
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        // Read file as binary data
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        // Set up download functionality for a button
        function setupDownload(buttonId, blob, filename) {
            const downloadBtn = document.getElementById(buttonId);
            const url = URL.createObjectURL(blob); // Create download URL
            
            downloadBtn.onclick = () => {
                console.log(`📥 Downloading: ${filename}`);
                
                // Create temporary download link and click it
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Clean up the URL to free memory
                URL.revokeObjectURL(url);
            };
        }

        // Update progress bar
        function updateProgress(progressId, percentage) {
            const progressFill = document.querySelector(`#${progressId} .progress-fill`);
            if (progressFill) {
                progressFill.style.width = Math.min(percentage, 100) + '%';
            }
        }

        // Show success result section
        function showResult(resultId) {
            const resultElement = document.getElementById(resultId);
            if (resultElement) {
                resultElement.style.display = 'block';
            }
        }

        // Hide result and error sections
        function hideResults(type) {
            const resultElement = document.getElementById(type + 'Result');
            const errorElement = document.getElementById(type + 'Error');
            if (resultElement) resultElement.style.display = 'none';
            if (errorElement) errorElement.style.display = 'none';
        }

        // Show error message
        function showError(errorId, message) {
            console.error(`❌ Error in ${errorId}:`, message);
            
            const errorSection = document.getElementById(errorId);
            const errorMsg = document.getElementById(errorId.replace('Error', 'ErrorMsg'));
            
            if (errorMsg) errorMsg.textContent = message;
            if (errorSection) errorSection.style.display = 'block';
        }

        // Show upgrade modal
        function showUpgradeModal() {
            document.getElementById('upgradeModal').style.display = 'block';
        }

        // Process premium upgrade (demo version)
        function processPremiumUpgrade() {
            // In real implementation, this would integrate with Stripe payment
            if (confirm('🚀 This would normally redirect to Stripe payment page. Simulate upgrade for demo?')) {
                userManager.upgradeToPremium();
            }
        }

        // Format file size for display
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Simple delay function for simulating processing time
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ===== ERROR HANDLING =====
        // Global error handling for better user experience
        window.addEventListener('error', function(e) {
            console.error('❌ Application error:', e.error);
            // In production, you could send error reports to analytics
        });

        // ===== PERFORMANCE MONITORING =====
        window.addEventListener('load', function() {
            const loadTime = performance.now();
            console.log(`⚡ Application loaded in ${Math.round(loadTime)}ms`);
        });

        // ===== KEYBOARD SHORTCUTS =====
        // Add keyboard shortcuts for power users
        document.addEventListener('keydown', function(e) {
            // Ctrl+U for upgrade modal
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                showUpgradeModal();
            }
        });

        // ===== USER PREFERENCES =====
        // Save and load user preferences
        function saveUserPreferences() {
            const preferences = {
                fontSize: document.getElementById('fontSize')?.value,
                preserveFormatting: document.getElementById('preservePdfFormatting')?.checked,
                addPageNumbers: document.getElementById('addPageNumbers')?.checked,
            };
            localStorage.setItem('userPreferences', JSON.stringify(preferences));
        }

        function loadUserPreferences() {
            const saved = localStorage.getItem('userPreferences');
            if (saved) {
                try {
                    const preferences = JSON.parse(saved);
                    
                    // Apply saved font size
                    if (preferences.fontSize) {
                        const fontSlider = document.getElementById('fontSize');
                        const fontValue = document.getElementById('fontSizeValue');
                        if (fontSlider && fontValue) {
                            fontSlider.value = preferences.fontSize;
                            fontValue.textContent = preferences.fontSize;
                        }
                    }
                    
                    // Apply other preferences
                    if (typeof preferences.preserveFormatting === 'boolean') {
                        const preserveBox = document.getElementById('preservePdfFormatting');
                        if (preserveBox) preserveBox.checked = preferences.preserveFormatting;
                    }
                    
                    if (typeof preferences.addPageNumbers === 'boolean') {
                        const pageNumBox = document.getElementById('addPageNumbers');
                        if (pageNumBox) pageNumBox.checked = preferences.addPageNumbers;
                    }
                } catch (error) {
                    console.warn('⚠️ Could not load user preferences:', error);
                }
            }
        }

        // Load preferences when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadUserPreferences();
            
            // Save preferences when changed
            document.addEventListener('change', function(e) {
                if (e.target.type === 'range' || e.target.type === 'checkbox') {
                    saveUserPreferences();
                }
            });
        });

        // ===== ANALYTICS PLACEHOLDER =====
        // Track user actions for business metrics (replace with real analytics)
        function trackEvent(action, category = 'conversion') {
            console.log(`📊 Analytics: ${category} - ${action}`);
            // Example: gtag('event', action, { event_category: category });
        }

        // Override the useConversion method to track conversions
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for userManager to be created
            setTimeout(() => {
                if (userManager) {
                    const originalUseConversion = userManager.useConversion.bind(userManager);
                    userManager.useConversion = function() {
                        originalUseConversion();
                        trackEvent('file_converted');
                    };
                }
            }, 100);
        });

        // ===== CONSOLE WELCOME MESSAGE =====
        console.log(`
🚀 DocConverter Pro - Developer Console

This application processes documents entirely in your browser for privacy.
No files are uploaded to servers - everything happens locally.

Features:
- OCR text extraction (Premium)
- Excel to PDF conversion
- PDF to multiple format conversion
- Text files to PDF

Libraries used:
- jsPDF for PDF creation
- SheetJS for Excel processing
- Native JavaScript for file handling

For business inquiries: hello@docconverterpro.com
        `);
    </script>
</body>
</html>
